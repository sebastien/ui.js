<!DOCTYPE html>
<html>
<body>
	<div id="placeholder" />

		<div class="ui" data-ui="Todo" data-state="{items:[{label:'Buy milk',checked:true},{label:'Buy cheese',checked:false}]}" ></div>

	<template id="Todo">
		<div class="Todo">
			<h3>Simple todo list</h3>
			<ul>
				<slot name="items" out-contents=".items|TodoItem" />
			<ul>
		</div>
		<script type="module">
			import {sub} from "../js/ui.js"


			// Low Level
			sub("TodoItem.Remove", (event)=> {
			})

			// High Level
			const TodoItem = controller({
				Remove: (event, data) => {
					console.log("TODO ITEM REMOVED", event);
				}
			})
			register({TodoItem});
		</script>
	</template>

	<template id="TodoItem">
		<div class="TodoItem">
			<input class="out on" when=".edited"  type="checkbox" out-checked=".checked|bool" on-change="XXX" />
			<input class="out in" when=".edited|not" type="text" out-value=".label" in-value=".value:change" />
			<button class="on" on-click="!Remove">Remove</button>
			<!--
			<input when:edited     type="checkbox" out:checked=".checked|bool" in:checked=".checkedDuplicate" />
			<input when:-edited type="text" out:value=".label" on:change=".value!" />
			-->
		</div>
		</div>
	</template>


	<script type="module">
		import ui from "../js/ui.js"
		// -- doc
		// Utility function to reload the page automatically when the given URL changes.
		export const reload = (url, period = 2000.0) => {
		  const state = { lastModified: undefined, stop: false, interval: undefined };
		  const update = () => {
			if (state.stop) {
			  window.clearInterval(state.interval);
			}
			fetch(url, { method: "HEAD" }).then((_) => {
			  const lastModified = _.headers.get("last-modified");
			  if (state.lastModified && state.lastModified !== lastModified) {
				state.lastModified = lastModified;
				console.log("ui.reload: Monitor has changed, reloading", { url });
				window.location.reload();
			  } else {
				state.lastModified = lastModified;
			  }
			});
		  };
		  state.interval = window.setInterval(update, period);
		  return state;
		};
		reload("../js/ui.js");

		ui()

	</script>
</body>
</html>
