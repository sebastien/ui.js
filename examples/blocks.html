<!DOCTYPE html>
<html lang="en-nz">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>UIjs − Block Based Notebook</title>
		<link
			rel="stylesheet"
			href="../lib/css/ui.css"
			type="text/css"
			media="all"
		/>
		<script type="importmap">
			{ "imports": { "@ui.js": "/lib/js/ui.js", "@ui/": "/lib/js/ui/" } }
		</script>
	</head>
	<body>
		<header>
			<h1>Blocks</h1>
			<p>Shows how to create a Jupyter-like notebook.</p>
		</header>

		<div class="Blocks">
			<slot
				template="Blocks"
				cells="([{type:'text',source:'Hello, world from a text cell'}])"
			/>
		</div>

		<!-------------------------------------------------------------------------

     BLOCKS

     ---------------------------------------------------------------------- -->

		<template name="Blocks" in:cells="">
			<ul x:for="cell=cells">
				<li><slot template="Cell" cell="cell" /></li>
				<li><slot template="Divider" cell="cell" /></li>
			</ul>
		</template>

		<!-------------------------------------------------------------------------

     CELL

     ---------------------------------------------------------------------- -->

		<template name="Cell" in:cell="" out:preview="">
			<ul class="stack">
				<!-- Preview -->
				<li class="row">
					<ul class="stack stretch">
						<li>
							<button
								class="square small transparent move icon-smaller"
							>
								<slot template="Icon" name="'menu'" />
							</button>
						</li>
					</ul>
					<div class="preview fill" out:content=".preview|html">
						Preview…
					</div>
					<div class="icon icon-small"></div>
				</li>

				<!-- Source code -->
				<li class="row strech">
					<div class="icon icon-small"></div>
					<div class="source fill">
						<textarea
							class="fit"
							out:content="cell.source"
							on:input="!SourceChanged"
						></textarea>
					</div>
					<ul class="stack stretch">
						<li>
							<div class="with-hover">
								<button
									class="square small transparent nopad icon-small"
								>
									<slot
										template="Icon"
										name="code-brackets"
									></slot>
								</button>
								<!-- FIXME: Anything after the slot does not appear -->
								<menu class="on-hover to-l to-t pos-abs shadow">
									<li class="selected">
										<span class="icon-small">
											<slot
												template="Icon"
												name="'text'"
											></slot>
										</span>
										<span>Text</span>
									</li>
									<li>
										<span class="icon-small">
											<slot
												template="Icon"
												name="'python'"
												source="'Devicons'"
											></slot>
										</span>
										<span>Python</span>
									</li>
									<li>
										<span class="icon-small">
											<slot
												template="Icon"
												name="'javascript'"
												source="'Devicons'"
											></slot>
										</span>
										<span>JavaScript</span>
									</li>
								</menu>
							</div>
						</li>
					</ul>
				</li>
			</ul>
		</template>

		<script type="module">
			import { controller } from "@ui.js";
			import { marked } from "https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js";
			const Cell = ({ on, scope, state }) => {
				on.SourceChanged((event) => {
					state.preview = marked.parse(event.target.value);
				});
			};
			controller(Cell);
		</script>

		<!-------------------------------------------------------------------------

     ICONS

     ---------------------------------------------------------------------- -->

		<template
			name="Icon"
			base="24"
			in:name="help-square"
			in:source="Iconoir"
		>
			<svg
				class="icon"
				out:height="size"
				out:viewbox="base->{`0 0 ${base} ${base}`}"
			>
				<use
					out:href="name,source->{`#icon-${name}-${(source||'generic').toLowerCase()}`}"
				/>
			</svg>
		</template>
		<script type="module">
			import { controller } from "@ui.js";
			import { loadIcon } from "@ui/icons.js";
			const Icon = ({ on, scope, state }) => {
				loadIcon(state.name, state.source);
			};
			controller(Icon);
		</script>

		<!-------------------------------------------------------------------------

     DIVIDER

     ---------------------------------------------------------------------- -->
		<template name="Divider">
			<div class="row with-hover">
				<button class="small circle transparent">
					<slot template="Icon" name="plus-circle" />
				</button>
				<hr class="faint fill on-hover" />
			</div>
		</template>

		<!-------------------------------------------------------------------------

     MAIN

     ---------------------------------------------------------------------- -->

		<script type="module">
			import ui from "@ui.js";
			ui();
		</script>
	</body>
</html>
